<div class="container-fluid bg-home">
  <app-menu-admin></app-menu-admin>
  <div class="container">
    <h4 class="mb-3">Actualizar evento</h4>
    <div class="form-container">
      <form [formGroup]="eventForm" (ngSubmit)="save()" class="form-grid">
        <div class="row">
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Nombre</mat-label>
                <input matInput formControlName="name" />
                <mat-error *ngIf="eventForm.get('name')?.hasError('required')">
                  El nombre de la ciudad es obligatorio.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Capacidad</mat-label>
                <input matInput formControlName="capacity" />
                <mat-error
                  *ngIf="eventForm.get('capacity')?.hasError('required')"
                >
                  La capacidad es obligatoria.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Código</mat-label>
                <input matInput formControlName="accessCode" />
                <mat-error
                  *ngIf="eventForm.get('accessCode')?.hasError('required')"
                >
                  El código es obligatorio.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Fecha de Inicio</mat-label>
                <input
                  matInput
                  [matDatepicker]="startPicker"
                  formControlName="startDate"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="startPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
                <mat-error
                  *ngIf="eventForm.get('startDate')?.hasError('required')"
                >
                  La fecha de inicio es obligatoria.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Fecha de Fin</mat-label>
                <input
                  matInput
                  [matDatepicker]="endPicker"
                  formControlName="endDate"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="endPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
                <mat-error
                  *ngIf="eventForm.get('endDate')?.hasError('required')"
                >
                  La fecha de fin es obligatoria.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Dirección</mat-label>
                <input matInput formControlName="address" />
                <mat-error
                  *ngIf="eventForm.get('address')?.hasError('required')"
                >
                  La dirección es obligatoria.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Descripción</mat-label>
                <input matInput formControlName="descripcion" />
              </mat-form-field>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Ciudad</mat-label>
                <mat-select formControlName="city">
                  <mat-option *ngFor="let city of cities" [value]="city.id">
                    {{ city.name }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="eventForm.get('city')?.hasError('required')">
                  Seleccione una ciudad.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Tipo de evento</mat-label>
                <mat-select formControlName="eventType">
                  <mat-option
                    *ngFor="let eventType of eventTypes"
                    [value]="eventType.id"
                  >
                    {{ eventType.eventName }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="eventForm.get('eventType')?.hasError('required')"
                >
                  Seleccione un tipo de evento.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Promotor</mat-label>
                <mat-select formControlName="promoter">
                  <mat-option
                    *ngFor="let promoter of promoters"
                    [value]="promoter.id"
                  >
                    {{ promoter.details }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="eventForm.get('promoter')?.hasError('required')"
                >
                  Seleccione un promotor.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Expositor</mat-label>
                <mat-select formControlName="promoter">
                  <mat-option
                    *ngFor="let expositor of expositors"
                    [value]="expositor.id"
                  >
                    {{ expositor.nameExpositor }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="eventForm.get('expositor')?.hasError('required')"
                >
                  Seleccione un expositor.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="form-field">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Sponsor</mat-label>
                <mat-select formControlName="promoter">
                  <mat-option
                    *ngFor="let sponsor of sponsors"
                    [value]="sponsor.id"
                  >
                    {{ sponsor.nombreSponsor }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="eventForm.get('sponsor')?.hasError('required')"
                >
                  Seleccione un sponsor.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="form-field">
              <button
                type="button"
                mat-raised-button
                (click)="fileInput.click()"
              >
                Seleccionar nueva imagen:
              </button>
              <input
                hidden
                (change)="SelectedFile($event)"
                #fileInput
                type="file"
              />
              <span class="file-name">{{
                selectedFile?.name || "Archivo actual conservado"
              }}</span>
              <div *ngIf="imageUrl || eventoActual?.image">
                <div class="d-flex justify-content-center" id="preview">
                  <img
                    [src]="imageUrl"
                    onerror="this.onerror=null;this.src='assets/images/img_not_found.jpg';"
                    class="mw-100 mb-4"
                    width="450"
                    style="max-height: 350px; object-fit: contain"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex mt-5 gap-3">
          <button
            mat-raised-button
            class="btn custom-dark-button"
            [disabled]="!eventForm.valid"
          >
            Actualizar
          </button>
          <button
            mat-raised-button
            class="btn custom-dark-button"
            type="button"
            (click)="cancel()"
          >
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
